---
import InfoModal from "./InfoModal.astro";
---

<div class="flex text-center">
  <script>
    function setup() {
      const player = document.getElementById("player");
      const playerSprite = document.getElementById("playerSprite");

      if (!player) return;
      const playerImg = player.querySelector("img");
      if (!playerImg) return;
      const playerWidth = playerImg.width;
      const playerHeight = playerImg.height;
      let playerX = player.offsetLeft;
      let playerY = player.offsetTop;
      const playerSpeed = 5;

      let nextX = playerX;
      let nextY = playerY;

      const boundsElement = document.getElementById("bounds");
      if (!boundsElement) return;
      let bounds = boundsElement.getBoundingClientRect();

      function movePlayer() {
        if (!playerImg) return;
        if (nextX < playerX && nextX != playerX) {
          playerSprite!.style.transform = "scaleX(1)";
        } else if (nextX != playerX) {
          playerSprite!.style.transform = "scaleX(-1)";
        }

        if (nextX < bounds.left) nextX = bounds.left;
        if (nextX + playerWidth > bounds.right) nextX = bounds.right - playerWidth;
        if (nextY < bounds.top) nextY = bounds.top;
        if (nextY + playerHeight > bounds.bottom) nextY = bounds.bottom - playerHeight;

        const dx = nextX - playerX;
        const dy = nextY - playerY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < playerSpeed) {
          playerX = nextX;
          playerY = nextY;
        } else {
          playerX += (dx / distance) * playerSpeed;
          playerY += (dy / distance) * playerSpeed;
        }
        player!.style.left = `${playerX}px`;
        player!.style.top = `${playerY}px`;
      }

      window.addEventListener("resize", () => {
        bounds = boundsElement.getBoundingClientRect();
      });
      document.addEventListener("mousedown", (e) => {
        console.log("move");
        nextX = e.clientX - playerWidth / 2;
        nextY = e.clientY - playerHeight / 2;
        console.log(player.style.left, player.style.top);
      });
      setInterval(movePlayer, 1000 / 60);
    }
    window.addEventListener("load", setup);
  </script>
  <InfoModal />
  <div id="player" class="absolute left-64 top-48 z-40">
    <div class="h-[10rem] w-[5rem] relative" id="playerSprite">
      <img src="/assets/player/head.png" class="absolute left-[-3px]" alt="Devon Crebbin" />
      <img src="/assets/player/body.png" class="absolute top-[2.5rem]" alt="Devon Crebbin" />
      <img src="/assets/player/leftArm.png" class="absolute top-[2.8rem] right-16" alt="Devon Crebbin" />
      <img src="/assets/player/rightArm.png" class="absolute top-[2.6rem] left-[1.8rem]" alt="Devon Crebbin" />
      <img src="/assets/player/leftLeg.png" class="absolute top-[6.5rem] left-[-0.5rem]" alt="Devon Crebbin" />
      <img src="/assets/player/rightLeg.png" class="absolute top-[6.8rem] left-[1.4rem]" alt="Devon Crebbin" />
    </div>
    <!-- <div class="w-[3rem] h-[1.5rem] bg-black/30 rounded-full blur-sm absolute left-[18.8rem] top-[20.9rem] z-30"></div> -->
  </div>
</div>
